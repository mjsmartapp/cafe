<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapple's Cafe - Employees</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <style>
        /* Existing CSS Styles */
        :root {
            --primary-color: #6a3d11;
            --secondary-color: #d8c29d;
            --accent-color: #a44a3f;
            --bg-color: #f7f2eb;
            --card-bg: #fff;
            --text-dark: #333;
            --text-light: #f4f4f4;
            --success-color: #4CAF50;
            --danger-color: #d32f2f;
            --info-color: #2196F3;
            --border-radius: 10px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --sidebar-width: 250px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-dark);
            display: flex;
            min-height: 100vh;
        }

        /* Container and Header */
        .container {
            flex-grow: 1;
            padding: 20px;
            transition: margin-left 0.3s;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--secondary-color);
        }

        .header h1 {
            color: var(--primary-color);
            font-weight: 700;
            font-size: 24px;
        }

        .header .actions {
            display: flex;
            gap: 10px;
        }

        /* Loader */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loader.active {
            display: flex;
        }

        .spinner {
            border: 4px solid var(--secondary-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Popup Message */
        #popup-message-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            color: var(--text-light);
            padding: 10px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            z-index: 999;
        }

        #popup-message-container.show {
            opacity: 1;
        }

        /* Buttons and Forms */
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: var(--text-light);
        }

        .btn-primary:hover {
            background-color: #4b2d0d;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #45a049;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-info {
            background-color: var(--info-color);
            color: white;
        }

        .btn-info:hover {
            background-color: #1e87e5;
        }

        /* Filter Section */
        .filter-section {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            background: var(--card-bg);
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .filter-section input {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        /* Table/Card Styles - NEW CARD LAYOUT */
        .card-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
            padding: 10px;
        }

        .order-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            border-left: 5px solid var(--primary-color);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .card-header h4 {
            color: var(--primary-color);
            font-size: 1.1em;
            font-weight: 600;
        }
        
        .card-body p {
            margin: 5px 0;
            font-size: 0.9em;
        }

        .card-body strong {
            color: var(--accent-color);
        }

        .card-footer {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-footer .status {
            font-weight: 700;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .card-footer .amount {
            font-size: 1.2em;
            font-weight: 700;
            color: var(--success-color);
        }

        /* Status Colors */
        .status[data-status="Pending"],
        .status[data-status="Send"] {
            background-color: #ffe0b2;
            color: #ff9800;
        }

        .status[data-status="Completed"] {
            background-color: #c8e6c9;
            color: var(--success-color);
        }

        .status[data-status="Cancelled"] {
            background-color: #ffcdd2;
            color: var(--danger-color);
        }

        /* Modals */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5); /* Black w/ opacity */
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: 90%;
            max-width: 600px;
            position: relative;
        }

        /* ... (rest of modal content styling) ... */
        .modal-content h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .modal-content label {
            display: block;
            margin-top: 10px;
            font-weight: 600;
        }

        .modal-content input[type="text"],
        .modal-content input[type="number"],
        .modal-content input[type="date"], /* Added input[type="date"] */
        .modal-content select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 20px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: var(--danger-color);
            text-decoration: none;
        }

        .modal-actions {
            margin-top: 20px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }


        /* Login Modal Specific */
        #login-modal .modal-content {
            max-width: 400px;
            text-align: left; /* Changed to left align for form labels */
        }

        /* New Order Modal Specific */
        .new-order-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            min-height: 400px;
        }

        .menu-selection {
    user-select: none;   /* Prevents text selection */
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
}


        .order-summary {
            background: var(--secondary-color);
            padding: 15px;
            border-radius: var(--border-radius);
            display: flex;
            flex-direction: column;
        }

        .product-card {
            background: var(--card-bg);
            border: 1px solid var(--secondary-color);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            cursor: pointer;
            position: relative;
            transition: background-color 0.2s;
        }

        .product-card:hover {
            background-color: #f0f0f0;
        }
        
        .product-card h4 {
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .product-card p {
            margin: 0;
            color: var(--accent-color);
            font-weight: 600;
        }

        .product-quantity-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: var(--success-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: none; /* Hidden by default */
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .product-quantity-badge.visible {
            display: flex;
        }

        .current-order-list {
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            padding-right: 5px;
        }

        .invoice-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px dotted #a0927f;
        }

        .invoice-item-info {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .invoice-item-info span:first-child {
            font-weight: 600;
        }

        .invoice-item-actions {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .quantity-btn, .remove-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 3px 6px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            line-height: 1;
        }
        
        .remove-btn {
            background: var(--danger-color);
        }

        .quantity {
            min-width: 15px;
            text-align: center;
            font-weight: 600;
        }

        .new-order-total {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 2px solid var(--primary-color);
            font-size: 1.5em;
            font-weight: 700;
            display: flex;
            justify-content: space-between;
        }
        /* ... (rest of invoice modal styles) ... */

        /* --- NEW STYLES FOR ATTENDANCE --- */

        /* QR Scanner Modal Specific */
        #qr-scanner-modal .modal-content {
            max-width: 400px;
            text-align: center;
        }

        #qr-scanner-placeholder {
            width: 100%;
            height: 250px;
            background-color: #f0f0f0;
            border: 2px dashed var(--primary-color);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.1em;
            color: var(--primary-color);
            margin-bottom: 15px;
            border-radius: var(--border-radius);
        }

        /* Attendance History Modal Specific */
        #attendance-history-modal .modal-content {
            max-width: 900px;
        }

        .attendance-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .attendance-table th, .attendance-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            font-size: 0.9em;
        }

        .attendance-table th {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .attendance-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        /* --- END NEW STYLES --- */


        /* Responsive Design */
@media (max-width: 768px) {
    #new-order-modal .modal-content {
        max-width: 95%;
        margin: 10px auto;
        height: 95vh;
        overflow-y: auto;
    }

    /* Stack inputs and sections vertically in clean order */
    #new-order-form > div:first-child {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    #new-order-form label {
        font-weight: 600;
        margin-top: 5px;
    }

    .new-order-grid {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }


@media (max-width: 768px) {
    #new-order-menu-items {
        display: grid;
        grid-template-columns: 1fr 1fr; /* two columns */
        gap: 10px;
    }

    .product-card {
        padding: 10px;
        margin: 0;
        font-size: 14px;
    }

    .product-card h4 {
        font-size: 14px;
    }

    .product-card p {
        font-size: 13px;
    }

    .product-quantity-badge {
        width: 18px;
        height: 18px;
        font-size: 11px;
    }
}


    /* Order: Menu Items first, then inputs, then Current Order */
    .menu-selection { order: 1; }
    #emp-id { order: 2; }
    #table-no { order: 3; }
    #customer-name { order: 4; }
    .order-summary { order: 5; }

    .new-order-total {
        display: block;
    }

    .mobile-total-sticky {
        display: none;
    }

    #new-order-modal .modal-content {
        max-width: 95%;
        margin: 10px auto;
        height: 95vh;
        overflow-y: auto;
    }

    .new-order-grid {
        grid-template-columns: 1fr;
    }

    .order-summary {
        order: -1; /* keep summary on top */
    }

    .new-order-total {
        display: block; /* ensure total shows inside summary */
    }

    .mobile-total-sticky {
        display: none; /* hide duplicate sticky total */
    }
}

        @media (max-width: 768px) {



    #new-order-modal .modal-content {
        max-width: 95%;
        margin: 10px auto;
        height: 95vh;
        overflow-y: auto;
    }

    /* Stack inputs and sections vertically in clean order */
    #new-order-form > div:first-child {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    #new-order-form label {
        font-weight: 600;
        margin-top: 5px;
    }

    .new-order-grid {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    /* Order: Menu Items first, then inputs, then Current Order */
    .menu-selection { order: 1; }
    #emp-id { order: 2; }
    #table-no { order: 3; }
    #customer-name { order: 4; }
    .order-summary { order: 5; }

    .new-order-total {
        display: block;
    }

    .mobile-total-sticky {
        display: none;
    }

            .filter-section {
                flex-direction: column;
                gap: 10px;
            }
            
            .header .actions {
                flex-direction: column;
                gap: 5px;
                align-items: flex-end;
            }
            
            .header h1 {
                font-size: 20px;
            }

            .new-order-grid {
                grid-template-columns: 1fr;
            }

            .menu-selection, .order-summary {
                max-height: none;
                height: auto;
            }

            .order-summary {
                order: -1; /* Move order summary to top on mobile */
            }

            .new-order-total {
                display: none; /* Hide total in side summary */
            }

            .mobile-total-sticky {
                position: sticky;
                bottom: 0;
                left: 0;
                width: 100%;
                background: var(--primary-color);
                color: var(--text-light);
                padding: 10px;
                text-align: center;
                font-size: 1.5em;
                z-index: 10;
                display: block;
            }

            .modal-content {
                max-width: 95%;
                margin: 10px;
            }
        }
    </style>
</head>
<body>
    <div id="loader" class="loader">
        <div class="spinner"></div>
    </div>

    <div id="popup-message-container"></div>

    <div class="container">
        <div class="header">
            <h1>Employee POS Dashboard</h1>
            <div class="actions">
                <button id="viewAttendanceBtn" class="btn btn-info" style="display: none;">ðŸ“Š Attendance</button> <button id="scanQrBtn" class="btn btn-primary" style="display: none;">ðŸ“· Scan QR</button> <button id="newOrderBtn" class="btn btn-primary">âž• New Order</button>
                <button id="logoutBtn" class="btn btn-danger" style="display: none;">ðŸšª Logout</button>
            </div>
        </div>

        <div class="filter-section">
            <input type="text" id="search-input" placeholder="Search Order ID, Table No..." style="flex-grow: 1;">
            <input type="date" id="date-input">
        </div>

        <div id="orders-card-container" class="card-container">
            </div>
        
    </div>

    <div class="modals-container">
        
        <div id="login-modal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 400px;">
                <h3>Employee Login</h3>
                <form id="login-form">
                    <label for="login-emp-id">Employee ID (EmpId):</label>
                    <input type="text" id="login-emp-id" required>
                    
                    <label for="login-dob">Date of Birth (DOB):</label>
                    <input type="date" id="login-dob" required>
                    
                    <div class="modal-actions" style="padding-top: 10px; justify-content: center;">
                        <button type="submit" class="btn btn-primary">Login</button>
                    </div>
                </form>
            </div>
        </div>
        <div id="new-order-modal" class="modal">
            <div class="modal-content" style="max-width: 1000px;">
                <span class="close-btn">&times;</span>
                <h3>Place New Order</h3>
                <form id="new-order-form">
                    <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                        <div style="flex-grow: 1;">
                            <label for="emp-id">Employee ID</label>
                            <input type="text" id="emp-id" required readonly> </div>
                        <div style="flex-grow: 1;">
                            <label for="table-no">Table No</label>
                            <input type="text" id="table-no" placeholder="Table Number" required>
                        </div>
                        <div style="flex-grow: 1;">
                            <label for="customer-name">Customer Name</label>
                            <input type="text" id="customer-name" placeholder="Customer Name (Optional)">
                        </div>
                    </div>
                    
                    <div class="new-order-grid">
                        <div class="menu-selection">
                            <h4>Menu Items</h4>
                            <div id="new-order-menu-items">
                                </div>
                        </div>
                        
                        <div class="order-summary">
                            <h4>Current Order</h4>
                            <div id="current-order-list" class="current-order-list">
                                </div>
                            <div class="new-order-total-container">
                                <div class="new-order-total">
                                    <span>Total:</span>
                                    <span>â‚¹<span id="new-order-total">0.00</span></span>
                                </div>
                            </div>
                            <div class="modal-actions">
                                <button type="button" class="btn btn-danger" id="new-order-cancel-btn">Cancel</button>
                                <button type="submit" class="btn btn-success" id="place-order-btn">Place Order</button>
                            </div>
                        </div>
                    </div>
                </form>
                <div class="mobile-total-sticky">
                    Total: â‚¹<span id="new-order-total-mobile">0.00</span>
                </div>
            </div>
        </div>

        <div id="order-details-modal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <span class="close-btn">&times;</span>
                <h3>Order Details</h3>
                <p><strong>Order ID:</strong> <span id="details-order-id"></span></p>
                <p><strong>Table No:</strong> <span id="details-table-no"></span></p>
                <p><strong>Customer:</strong> <span id="details-customer-name"></span></p>
                <p><strong>Status:</strong> <span id="details-order-status"></span></p>
                <hr>
                <h4>Items:</h4>
                <ul id="details-order-items" class="details-list"></ul>
                <hr>
                <p style="font-size: 1.2em;"><strong>Total Amount:</strong> â‚¹<span id="details-total-amount"></span></p>
                
                <div class="modal-actions">
                    <button class="btn btn-danger" id="cancel-order-btn">Cancel Order</button>
                    <button class="btn btn-info" id="edit-order-btn">Edit Order</button>
                </div>
            </div>
        </div>

        <div id="invoice-modal" class="modal">
            <div class="modal-content" style="max-width: 500px; text-align: center;">
                <span class="close-btn">&times;</span>
                <h3>Finalise Payment for Order <span id="invoice-order-id"></span></h3>
                <p style="font-size: 1.5em; font-weight: 700; color: var(--accent-color);">
                    Total: â‚¹<span id="invoice-total-amount">0.00</span>
                </p>
                
                <h4>Select Payment Method:</h4>
                <div class="payment-methods">
                    <button data-method="Cash" id="pay-cash-btn">Cash</button>
                    <button data-method="Online" id="pay-online-btn">Online/UPI</button>
                    <button data-method="Split" id="pay-split-btn">Split</button>
                </div>

                <div id="split-payment-section">
                    <div class="split-row">
                        <label for="cash-split-amount">Cash Amount:</label>
                        <input type="number" id="cash-split-amount" step="0.01" min="0" placeholder="0.00">
                    </div>
                    <div class="split-row">
                        <label for="online-split-amount">Online Amount:</label>
                        <input type="number" id="online-split-amount" step="0.01" min="0" readonly placeholder="0.00">
                    </div>
                    <p style="margin-top: 5px;">Remaining (Error Check): <span class="remaining-amount">â‚¹<span id="split-remaining">0.00</span></span></p>
                </div>

                <div class="modal-actions" style="justify-content: center;">
                    <button class="btn btn-success" id="finalise-payment-btn" disabled>Finalise Payment</button>
                </div>
            </div>
        </div>
        
        <div id="qr-scanner-modal" class="modal">
            <div class="modal-content" style="max-width: 400px; text-align: center;">
                <span class="close-btn">&times;</span>
                <h3>Scan Attendance QR Code</h3>
                <div id="qr-scanner-placeholder">
                    [Camera Feed Placeholder]<br> (Requires external library like Instascan)
                </div>
                <p>Scanning for QR code generated by the system.</p>
                <div class="modal-actions" style="justify-content: center;">
                     <button class="btn btn-info" id="simulate-scan-btn">Simulate Scan (Use Demo ID)</button>
                </div>
            </div>
        </div>
        
        <div id="attendance-history-modal" class="modal">
            <div class="modal-content" style="max-width: 900px;">
                <span class="close-btn">&times;</span>
                <h3>My Attendance History (Employee: <span id="attendance-emp-id-span"></span>)</h3>
                <table class="attendance-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Emp ID</th>
                            <th>Emp Name</th>
                            <th>IN Time</th>
                            <th>OUT Time</th>
                            <th>Total Hours</th>
                        </tr>
                    </thead>
                    <tbody id="attendance-history-body">
                        </tbody>
                </table>
            </div>
        </div>

    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const popupMessageContainer = document.getElementById('popup-message-container');
            const loader = document.getElementById('loader');

            // NEW Login Modal Elements
            const loginModal = document.getElementById('login-modal');
            const loginForm = document.getElementById('login-form');
            const loginEmpIdInput = document.getElementById('login-emp-id');
            const loginDobInput = document.getElementById('login-dob'); 

            // Header Action Buttons
            const newOrderBtn = document.getElementById('newOrderBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const scanQrBtn = document.getElementById('scanQrBtn'); // NEW
            const viewAttendanceBtn = document.getElementById('viewAttendanceBtn'); // NEW
            
            // NEW Attendance Modals
            const qrScannerModal = document.getElementById('qr-scanner-modal');
            const simulateScanBtn = document.getElementById('simulate-scan-btn');
            const attendanceHistoryModal = document.getElementById('attendance-history-modal');
            const attendanceHistoryBody = document.getElementById('attendance-history-body');
            const attendanceEmpIdSpan = document.getElementById('attendance-emp-id-span');

            // Orders List Container (Card View)
            const ordersCardContainer = document.getElementById('orders-card-container');


            // ... (Existing modal element declarations)
            const invoiceModal = document.getElementById('invoice-modal');
            const splitPaymentSection = document.getElementById('split-payment-section');
            const cashSplitAmountInput = document.getElementById('cash-split-amount');
            const onlineSplitAmountInput = document.getElementById('online-split-amount');
            const splitRemainingSpan = document.getElementById('split-remaining');
            const finalisePaymentBtn = document.getElementById('finalise-payment-btn');

            // Filter elements (Existing)
            const searchInput = document.getElementById('search-input');
            const dateInput = document.getElementById('date-input');

            let currentOrderToComplete = null;
            let totalOrderAmount = 0;
            let loggedInEmpId = null; 

            const showLoader = () => { loader.classList.add('active'); };
            const hideLoader = () => { setTimeout(() => { loader.classList.remove('active'); }, 500); };

            const firebaseConfig = {
                apiKey: "AIzaSyABDWSr0M_A9sVw351QLm_MMfUDnLzW5Ik",
                authDomain: "mapples-8da36.firebaseapp.com",
                databaseURL: "https://mapples-8da36-default-rtdb.firebaseio.com",
                projectId: "mapples-8da36",
                storageBucket: "mapples-8da36.appspot.com",
                messagingSenderId: "673045371502",
                appId: "1:673045371502:web:095d625ab71b1fc7ada47f",
                measurementId: "G-Q9Q5YZD7J3"
            };

            firebase.initializeApp(firebaseConfig);
            const database = firebase.database();

            let products = [];
            let orders = [];
            let employees = []; 
            let attendanceRecords = []; // NEW
            let currentOrder = [];
            let currentOrderId = null;

            const ordersTableBody = document.querySelector('#orders-table-body'); 
            const newOrderModal = document.getElementById('new-order-modal');
            const empIdInput = document.getElementById('emp-id'); 

            const showPopupMessage = (message) => {
                popupMessageContainer.textContent = message;
                popupMessageContainer.classList.add('show');
                setTimeout(() => {
                    popupMessageContainer.classList.remove('show');
                }, 3000);
            };

            // ------------------------------------
            // Login/Authentication Functions
            // ------------------------------------
            const updateUIForLoginStatus = (isLoggedIn) => {
                newOrderBtn.style.display = isLoggedIn ? 'inline-block' : 'none';
                logoutBtn.style.display = isLoggedIn ? 'inline-block' : 'none';
                scanQrBtn.style.display = isLoggedIn ? 'inline-block' : 'none'; // NEW
                viewAttendanceBtn.style.display = isLoggedIn ? 'inline-block' : 'none'; // NEW
                
                if (!isLoggedIn) {
                    ordersCardContainer.innerHTML = '';
                    loginModal.style.display = 'flex';
                }
                // Call renderOrderCards whenever login status changes to refresh the list
                renderOrderCards(searchInput.value, dateInput.value); 
            };

            const checkLoginStatus = () => {
                const storedEmpId = localStorage.getItem('mapples_empId');
                
                if (storedEmpId) {
                    const employeeExists = employees.some(emp => emp.empId === storedEmpId);
                    if (employeeExists) {
                        loggedInEmpId = storedEmpId;
                        loginModal.style.display = 'none';
                        updateUIForLoginStatus(true);
                        return;
                    } else {
                        localStorage.removeItem('mapples_empId');
                    }
                }
                
                loggedInEmpId = null;
                updateUIForLoginStatus(false);
            };

            const handleLogin = (e) => {
                e.preventDefault();
                const enteredEmpId = loginEmpIdInput.value.trim(); 
                const enteredDob = loginDobInput.value; 
                
                const validEmployee = employees.find(emp => 
                    emp.empId === enteredEmpId && emp.dob === enteredDob
                );

                if (validEmployee) {
                    loggedInEmpId = enteredEmpId;
                    localStorage.setItem('mapples_empId', loggedInEmpId); 
                    loginModal.style.display = 'none';
                    updateUIForLoginStatus(true);
                    showPopupMessage(`Welcome, Employee ${validEmployee.name}!`);
                } else {
                    showPopupMessage('Invalid Employee ID or Date of Birth. Please try again.');
                }
            };

            const handleLogout = () => {
                localStorage.removeItem('mapples_empId');
                loggedInEmpId = null;
                showPopupMessage('You have been logged out.');
                updateUIForLoginStatus(false);
                loginForm.reset(); 
            };
            
            loginForm.addEventListener('submit', handleLogin);
            logoutBtn.addEventListener('click', handleLogout);
            // ------------------------------------
            
            // ------------------------------------
            // NEW Attendance Logic
            // ------------------------------------
            scanQrBtn.addEventListener('click', () => {
                if (!loggedInEmpId) {
                    showPopupMessage('Please log in to scan attendance.');
                    loginModal.style.display = 'flex';
                    return;
                }
                qrScannerModal.style.display = 'flex';
            });
            
            viewAttendanceBtn.addEventListener('click', () => {
                if (!loggedInEmpId) {
                    showPopupMessage('Please log in to view attendance.');
                    return;
                }
                renderAttendanceHistory();
                attendanceHistoryModal.style.display = 'flex';
            });
            
            const renderAttendanceHistory = () => {
                attendanceHistoryBody.innerHTML = '';
                attendanceEmpIdSpan.textContent = loggedInEmpId;
                
                const employeeAttendance = attendanceRecords.filter(rec => rec.empId === loggedInEmpId)
                                                          .sort((a, b) => new Date(b.date) - new Date(a.date));

                if (employeeAttendance.length === 0) {
                    attendanceHistoryBody.innerHTML = '<tr><td colspan="6" style="text-align: center;">No attendance records found.</td></tr>';
                    return;
                }

                employeeAttendance.forEach(rec => {
                    const totalHours = rec.outTime && rec.inTime 
                        ? calculateTotalHours(rec.inTime, rec.outTime)
                        : 'N/A';
                    
                    const row = attendanceHistoryBody.insertRow();
                    row.innerHTML = `
                        <td>${rec.date}</td>
                        <td>${rec.empId}</td>
                        <td>${rec.empName}</td>
                        <td>${rec.inTime || '---'}</td>
                        <td>${rec.outTime || '---'}</td>
                        <td>${totalHours}</td>
                    `;
                });
            };
            
            const calculateTotalHours = (inTimeStr, outTimeStr) => {
                // Takes HH:MM:SS strings and calculates the difference in HH:MM format
                const [inH, inM, inS] = inTimeStr.split(':').map(Number);
                const [outH, outM, outS] = outTimeStr.split(':').map(Number);

                const inTimeInSeconds = inH * 3600 + inM * 60 + inS;
                const outTimeInSeconds = outH * 3600 + outM * 60 + outS;

                let diffSeconds = outTimeInSeconds - inTimeInSeconds;
                if (diffSeconds < 0) diffSeconds += 24 * 3600; // Handle overnight

                const hours = Math.floor(diffSeconds / 3600);
                const minutes = Math.floor((diffSeconds % 3600) / 60);

                return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
            };

            const processAttendanceScan = async (scannedId) => {
                qrScannerModal.style.display = 'none';
                showLoader();
                
                const empId = loggedInEmpId;
                const employee = employees.find(e => e.empId === empId);
                const empName = employee ? employee.name : 'N/A';

                // The scannedId format is "YYYY-MM-DD-xxxxxxxxxxx" 
                // We only need the date part: YYYY-MM-DD
                const datePart = scannedId.split('-').slice(0, 3).join('-'); 
                const currentTime = new Date();
                const timeString = currentTime.toLocaleTimeString('en-US', { hour12: false }); // HH:MM:SS
                
                // Construct the Firebase key
                const attendanceKey = `${datePart}_${empId}`;
                const attendanceRef = database.ref(`attendance/${attendanceKey}`);
                
                try {
                    const snapshot = await attendanceRef.once('value');
                    const existingRecord = snapshot.val();

                    if (!existingRecord || !existingRecord.inTime) {
                        // Clock IN
                        const newRecord = {
                            attendanceId: scannedId,
                            date: datePart,
                            empId: empId,
                            empName: empName,
                            inTime: timeString,
                            outTime: null,
                            totalHours: null,
                            generatedBy: "System"
                        };
                        await attendanceRef.set(newRecord);
                        showPopupMessage(`Clock IN successful at ${timeString}!`);

                    } else if (existingRecord && !existingRecord.outTime) {
                        // Clock OUT
                        const totalHours = calculateTotalHours(existingRecord.inTime, timeString);
                        await attendanceRef.update({
                            outTime: timeString,
                            totalHours: totalHours
                        });
                        showPopupMessage(`Clock OUT successful at ${timeString}. Total hours: ${totalHours}`);

                    } else {
                        // Already clocked in and out
                        showPopupMessage(`You have already clocked IN and OUT for ${datePart}.`);
                    }

                } catch (error) {
                    console.error("Error processing attendance:", error);
                    showPopupMessage('Failed to process attendance. Please try again.');
                } finally {
                    hideLoader();
                }
            };

            // Simulate the QR scan with a dummy ID
            simulateScanBtn.addEventListener('click', () => {
                const today = new Date();
                const yyyy = today.getFullYear();
                const mm = String(today.getMonth() + 1).padStart(2, '0');
                const dd = String(today.getDate()).padStart(2, '0');
                
                // Placeholder ID structure
                const dummyAttendanceId = `${yyyy}-${mm}-${dd}-DEMO-SCANNER-ID`; 
                processAttendanceScan(dummyAttendanceId);
            });
            // ------------------------------------


            // ... (Rest of utility functions like generateOrderId, generateInvoiceNumber)
            const generateOrderId = async () => { /* ... existing function ... */
                const today = new Date();
                const dd = String(today.getDate()).padStart(2, '0');
                const mm = String(today.getMonth() + 1).padStart(2, '0');
                const todayKey = `${dd}${mm}`;

                const counterRef = database.ref(`dailyOrderCounters/${todayKey}`);
                let counter = 0;
                await counterRef.transaction((currentValue) => {
                    return (currentValue || 0) + 1;
                }, (error, committed, snapshot) => {
                    if (error) {
                        console.error("Order counter transaction failed: ", error);
                    } else if (committed) {
                        counter = snapshot.val();
                    }
                });

                const nnn = String(counter).padStart(3, '0');
                return `${todayKey}${nnn}`;
            };

            const generateInvoiceNumber = async (dateObj) => { /* ... existing function ... */
                const yyyy = String(dateObj.getFullYear());
                const mm = String(dateObj.getMonth() + 1).padStart(2, '0');
                const todayKey = `${yyyy}${mm}`; // YYYYMM

                const counterRef = database.ref(`monthlyInvoiceCounters/${todayKey}`);
                let counter = 0;
                await counterRef.transaction((currentValue) => {
                    return (currentValue || 0) + 1;
                }, (error, committed, snapshot) => {
                    if (error) {
                        console.error("Invoice counter transaction failed: ", error);
                    } else if (committed) {
                        counter = snapshot.val();
                    }
                });

                const nnnn = String(counter).padStart(4, '0');
                return `${yyyy}${mm}${nnnn}`;
            };

            // Common Modal Logic 
            document.querySelectorAll('.modal .close-btn, #new-order-cancel-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const modal = btn.closest('.modal');
                    if(modal.id !== 'login-modal') { 
                        modal.style.display = 'none';
                    }
                });
            });

            // Orders Logic
            newOrderBtn.addEventListener('click', () => {
                if (!loggedInEmpId) {
                    showPopupMessage('Please log in first using your Employee ID.');
                    loginModal.style.display = 'flex';
                    return;
                }
                
                empIdInput.value = loggedInEmpId;
                
                document.getElementById('table-no').value = '';
                document.getElementById('customer-name').value = '';
                currentOrder = [];
                currentOrderId = null;
                document.getElementById('place-order-btn').textContent = 'Place Order';
                renderNewOrderMenuItems();
                renderCurrentOrderList();
                renderNewOrderTotal();
                newOrderModal.style.display = 'flex';
            });

            // UPDATED: Card View Rendering Function to filter by loggedInEmpId
            const renderOrderCards = (searchText = '', filterDate = '') => { 
                ordersCardContainer.innerHTML = ''; 

                if (!loggedInEmpId) {
                    // Show no orders if not logged in
                    ordersCardContainer.innerHTML = '<p style="text-align: center; margin-top: 50px;">Please log in to view your orders.</p>';
                    return;
                }

                const filteredOrders = orders.filter(order => {
                    // Filter 1: Only show orders created by the logged-in employee
                    const matchesEmployee = order.empId === loggedInEmpId;
                    if (!matchesEmployee) return false;

                    // Filter 2: Search text filter
                    const searchLower = searchText.toLowerCase();
                    const orderDate = new Date(order.timestamp).toISOString().split('T')[0];
                    const matchesSearch = searchText === '' ||
                        (order.displayId && order.displayId.toLowerCase().includes(searchLower)) ||
                        (order.empId && order.empId.toLowerCase().includes(searchLower)) ||
                        (order.empName && order.empName.toLowerCase().includes(searchLower)) ||
                        (order.customerName && order.customerName.toLowerCase().includes(searchLower)) ||
                        (order.tableNo && order.tableNo.toLowerCase().includes(searchLower));

                    // Filter 3: Date filter
                    const matchesDate = filterDate === '' || orderDate === filterDate;

                    return matchesSearch && matchesDate;
                });

                filteredOrders.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                if (filteredOrders.length === 0) {
                     ordersCardContainer.innerHTML = '<p style="text-align: center; margin-top: 50px;">No orders found matching the criteria for Employee ' + loggedInEmpId + '.</p>';
                     return;
                }

                filteredOrders.forEach(order => {
                    const orderTime = new Date(order.timestamp).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });

                    const card = document.createElement('div');
                    card.classList.add('order-card');
                    card.innerHTML = `
                        <div class="card-header">
                            <h4>Order: ${order.displayId || 'N/A'}</h4>
                            <p>${orderTime}</p>
                        </div>
                        <div class="card-body">
                            <p><strong>Table No:</strong> ${order.tableNo || 'N/A'}</p>
                            <p><strong>Customer:</strong> ${order.customerName || 'N/A'}</p>
                            <p><strong>Staff:</strong> ${order.empId || 'N/A'} (${order.empName || 'N/A'})</p>
                        </div>
                        <div class="card-footer">
                            <span class="amount">â‚¹${order.totalAmount.toFixed(2)}</span>
                            <span class="status" data-status="${order.status}">${order.status}</span>
                            <button class="btn btn-info view-order-details-btn" data-id="${order.orderId}">View</button>
                        </div>
                    `;
                    ordersCardContainer.appendChild(card);
                });
            };

            // Event listener for Order Card clicks (Delegated to container)
            ordersCardContainer.addEventListener('click', (e) => { 
                if (e.target.classList.contains('view-order-details-btn')) {
                    const id = e.target.dataset.id;
                    const order = orders.find(o => o.orderId === id);
                    if (order && order.empId === loggedInEmpId) { // Added check for loggedInEmpId
                        // Populate Order Details Modal (details-order-id, etc. elements must exist)
                        const orderDetailsModal = document.getElementById('order-details-modal');
                        document.getElementById('details-order-id').textContent = order.displayId || 'N/A';
                        document.getElementById('details-table-no').textContent = order.tableNo;
                        document.getElementById('details-customer-name').textContent = order.customerName || 'N/A';
                        document.getElementById('details-total-amount').textContent = order.totalAmount.toFixed(2);
                        document.getElementById('details-order-status').textContent = order.status;
                        const itemsList = document.getElementById('details-order-items');
                        itemsList.innerHTML = '';
                        order.items.forEach(item => {
                            const itemTotal = item.total || (item.price * item.quantity);
                            const li = document.createElement('li');
                            li.innerHTML = `<span>${item.name} x${item.quantity}</span><span>â‚¹${itemTotal.toFixed(2)}</span>`;
                            itemsList.appendChild(li);
                        });

                        const cancelBtn = document.getElementById('cancel-order-btn');
                        const editBtn = document.getElementById('edit-order-btn');
                        
                        const isPendingOrSend = order.status === 'Pending' || order.status === 'Send';
                        cancelBtn.style.display = isPendingOrSend ? 'inline-block' : 'none';
                        editBtn.style.display = isPendingOrSend ? 'inline-block' : 'none';
                        
                        editBtn.onclick = () => {
                            currentOrderId = order.orderId;
                            // Deep copy items array for editing
                            currentOrder = order.items.map(item => ({...item, total: undefined}));
                            document.getElementById('emp-id').value = order.empId;
                            document.getElementById('table-no').value = order.tableNo;
                            document.getElementById('customer-name').value = order.customerName;
                            document.getElementById('place-order-btn').textContent = 'Update Order';
                            renderNewOrderMenuItems();
                            renderCurrentOrderList();
                            renderNewOrderTotal();
                            orderDetailsModal.style.display = 'none';
                            newOrderModal.style.display = 'flex';

                            currentOrder.forEach(item => {
                                const quantityBadge = document.getElementById(`qty-card-${item.id}`);
                                if (quantityBadge) {
                                    quantityBadge.textContent = item.quantity;
                                    quantityBadge.classList.add('visible');
                                }
                            });
                        };

                        cancelBtn.onclick = async () => {
                            await database.ref('orders/' + id).update({ status: 'Cancelled' });
                            showPopupMessage('Order cancelled.');
                            orderDetailsModal.style.display = 'none';
                        };


                        orderDetailsModal.style.display = 'flex';
                    } else if (order) {
                         showPopupMessage('You do not have permission to view details for this order.');
                    }
                }
            });


            // ... (Rest of helper functions)
            
            const renderNewOrderMenuItems = () => { 
                const newOrderMenuItems = document.getElementById('new-order-menu-items');
                newOrderMenuItems.innerHTML = '';
                products.forEach(product => {
                    const card = document.createElement('div');
                    card.classList.add('product-card');
                    card.dataset.id = product.id;
                    
                    const currentQty = (currentOrder.find(item => item.id === product.id)?.quantity || 0);

                    card.innerHTML = `
                        <h4>${product.name}</h4>
                        <p>â‚¹${product.price.toFixed(2)}</p>
                        <span class="product-quantity-badge ${currentQty > 0 ? 'visible' : ''}" 
                              id="qty-card-${product.id}">${currentQty}</span>
                    `;
                    newOrderMenuItems.appendChild(card);
                });
            };

            const renderCurrentOrderList = () => { 
                const currentOrderList = document.getElementById('current-order-list');
                const newOrderModal = document.getElementById('new-order-modal');
                currentOrderList.innerHTML = '';
                currentOrder.forEach(item => {
                    const listItem = document.createElement('div');
                    listItem.classList.add('invoice-item');
                    listItem.dataset.id = item.id;
                    listItem.innerHTML = `
                        <div class="invoice-item-info">
                            <span>${item.name}</span>
                            <span>â‚¹${(item.price * item.quantity).toFixed(2)}</span>
                        </div>
                        <div class="invoice-item-actions">
                            <button type="button" class="quantity-btn decrease-quantity-btn" data-id="${item.id}">-</button>
                            <span class="quantity">${item.quantity}</span>
                            <button type="button" class="quantity-btn increase-quantity-btn" data-id="${item.id}">+</button>
                            <button type="button" class="remove-btn" data-id="${item.id}">&times;</button>
                        </div>
                    `;
                    currentOrderList.appendChild(listItem);
                });

                // Event listeners for quantity controls
                newOrderModal.querySelectorAll('.increase-quantity-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const itemId = event.target.dataset.id;
                        const itemToUpdate = currentOrder.find(item => item.id === itemId);
                        if (itemToUpdate) {
                            itemToUpdate.quantity++;
                            renderCurrentOrderList();
                            renderNewOrderTotal();
                            const quantityBadge = document.getElementById(`qty-card-${itemId}`);
                            if (quantityBadge) {
                                quantityBadge.textContent = itemToUpdate.quantity;
                                quantityBadge.classList.add('visible');
                            }
                        }
                    });
                });

                newOrderModal.querySelectorAll('.decrease-quantity-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const itemId = event.target.dataset.id;
                        const itemToUpdate = currentOrder.find(item => item.id === itemId);
                        if (itemToUpdate && itemToUpdate.quantity > 1) {
                            itemToUpdate.quantity--;
                            renderCurrentOrderList();
                            renderNewOrderTotal();
                            const quantityBadge = document.getElementById(`qty-card-${itemId}`);
                            if (quantityBadge) {
                                quantityBadge.textContent = itemToUpdate.quantity;
                            }
                        } else if (itemToUpdate && itemToUpdate.quantity === 1) {
                            const itemIndex = currentOrder.findIndex(item => item.id === itemId);
                            currentOrder.splice(itemIndex, 1);
                            renderCurrentOrderList();
                            renderNewOrderTotal();
                            const quantityBadge = document.getElementById(`qty-card-${itemId}`);
                            if (quantityBadge) {
                                quantityBadge.textContent = '0';
                                quantityBadge.classList.remove('visible');
                            }
                        }
                    });
                });

                newOrderModal.querySelectorAll('.remove-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const itemId = event.target.dataset.id;
                        const itemIndex = currentOrder.findIndex(item => item.id === itemId);
                        if (itemIndex > -1) {
                            currentOrder.splice(itemIndex, 1);
                            renderCurrentOrderList();
                            renderNewOrderTotal();
                            const quantityBadge = document.getElementById(`qty-card-${itemId}`);
                            if (quantityBadge) {
                                quantityBadge.textContent = '0';
                                quantityBadge.classList.remove('visible');
                            }
                        }
                    });
                });
            };

            const renderNewOrderTotal = () => { 
                const newOrderTotalSpan = document.getElementById('new-order-total');
                const newOrderTotalMobileSpan = document.getElementById('new-order-total-mobile');
                const total = currentOrder.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const totalString = total.toFixed(2);
                newOrderTotalSpan.textContent = totalString;
                newOrderTotalMobileSpan.textContent = totalString;
            };

            const newOrderMenuItems = document.getElementById('new-order-menu-items');
            newOrderMenuItems.addEventListener('click', (e) => { 
                const card = e.target.closest('.product-card');
                if (!card) return;

                const id = card.dataset.id;
                const product = products.find(p => p.id === id);
                if (!product) return;

                let existingItem = currentOrder.find(item => item.id === id);

                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    existingItem = { ...product, quantity: 1 };
                    currentOrder.push(existingItem);
                }

                const quantityBadge = document.getElementById(`qty-card-${id}`);
                if (quantityBadge) {
                    quantityBadge.textContent = existingItem.quantity;
                    quantityBadge.classList.add('visible');
                }

                renderCurrentOrderList();
                renderNewOrderTotal();
            });

            const newOrderForm = document.getElementById('new-order-form');
            newOrderForm.addEventListener('submit', async (e) => { 
                e.preventDefault();
                showLoader();
                const empId = empIdInput.value; 
                const tableNo = document.getElementById('table-no').value.trim();
                const customerName = document.getElementById('customer-name').value;
                const totalAmount = parseFloat(document.getElementById('new-order-total').textContent);

                const employee = employees.find(emp => emp.empId === empId); 
                const empName = employee ? employee.name : 'N/A';

                if (!empId) {
                    hideLoader();
                    showPopupMessage('Employee ID is required!');
                    return;
                }
                
                if (!tableNo) {
                    hideLoader();
                    showPopupMessage('Table No is required!');
                    return;
                }

                if (currentOrder.length === 0) {
                    hideLoader();
                    showPopupMessage('Order cannot be empty!');
                    return;
                }

                try {
                    let orderRef;
                    let displayId;

                    if (currentOrderId) {
                        orderRef = database.ref('orders/' + currentOrderId);
                        const snapshot = await orderRef.once('value');
                        displayId = snapshot.val().displayId;
                    } else {
                        const newOrderIdKey = database.ref('orders').push().key;
                        orderRef = database.ref('orders/' + newOrderIdKey);
                        currentOrderId = newOrderIdKey;
                        displayId = await generateOrderId();
                    }


                    const orderData = {
                        orderId: currentOrderId,
                        displayId: displayId,
                        empId,
                        empName,
                        tableNo,
                        customerName,
                        items: currentOrder.map(item => ({...item, total: parseFloat((item.price * item.quantity).toFixed(2))})),
                        totalAmount: parseFloat(totalAmount.toFixed(2)),
                        status: currentOrderId ? 'Pending' : 'Pending',
                        timestamp: new Date().toISOString()
                    };

                    await orderRef.set(orderData);
                    showPopupMessage(currentOrderId ? 'Order updated successfully!' : 'Order placed successfully!');
                    newOrderModal.style.display = 'none';
                } catch (error) {
                    console.error("Error placing/updating order:", error);
                    showPopupMessage('Failed to place/update order.');
                } finally {
                    hideLoader();
                }
            });

            


            // Firebase Data Listeners (Existing, but calling renderOrderCards)
            database.ref('products').on('value', (snapshot) => {
                products = [];
                snapshot.forEach(childSnapshot => {
                    products.push(childSnapshot.val());
                });
                renderNewOrderMenuItems();
            });

            // UPDATED: When orders load, call renderOrderCards
            database.ref('orders').on('value', (snapshot) => {
                orders = [];
                snapshot.forEach(childSnapshot => {
                    const order = childSnapshot.val();
                    orders.push(order);
                });
                renderOrderCards(searchInput.value, dateInput.value); 
            });
            
            // NEW: Attendance Records Listener
            database.ref('attendance').on('value', (snapshot) => {
                attendanceRecords = [];
                snapshot.forEach(childSnapshot => {
                    attendanceRecords.push(childSnapshot.val());
                });
            });

            // UPDATED: After employees load, check login status (which calls renderOrderCards)
            database.ref('employees').on('value', (snapshot) => {
                employees = [];
                snapshot.forEach(childSnapshot => {
                    employees.push(childSnapshot.val());
                });
                checkLoginStatus(); 
            });


            // Add event listeners for filtering (Existing - now works on filtered data)
            searchInput.addEventListener('input', () => renderOrderCards(searchInput.value, dateInput.value));
            dateInput.addEventListener('change', () => renderOrderCards(searchInput.value, dateInput.value));
        });
    </script>

<script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs@gh-pages/qrcode.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const qrContainer = document.getElementById("qr-code");
      if (qrContainer) {
        new QRCode(qrContainer, {
          text: window.location.href,
          width: 70,
          height: 70
        });
      }
    });
  </script>

</body>
</html>